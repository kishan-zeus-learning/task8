<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <title>Scroll Up/Down Add Rows at Top/Bottom</title>
  <style>
    #scroll-container {
      height: 300px;
      overflow-y: scroll;
      border: 1px solid #ccc;
      font-family: sans-serif;
      padding: 0;
      margin: 0;
    }
    .row {
      height: 40px;
      border-bottom: 1px solid #eee;
      padding: 10px;
      box-sizing: border-box;
      background: #f9f9f9;
    }
  </style>
</head>
<body>

<h2>Mount Rows on Scroll Up/Down at Top/Bottom</h2>
<div id="scroll-container"></div>

<script>
  const TOTAL_ROWS = 1000;
  const ROW_HEIGHT = 40;
  const VISIBLE_ROWS = 10;
  const BUFFER = 3;

  const container = document.getElementById('scroll-container');
  let startIndex = 0;  // Index of first visible row
  let lastScrollTop = 0;

  // Mount initial rows from 0 to VISIBLE_ROWS + buffer
  function mountInitialRows() {
    for (let i = startIndex; i < startIndex + VISIBLE_ROWS + BUFFER; i++) {
      if (i < TOTAL_ROWS) {
        const row = document.createElement('div');
        row.className = 'row';
        row.textContent = `Row ${i + 1}`;
        container.appendChild(row);
      }
    }
  }

  mountInitialRows();

  container.addEventListener('scroll', () => {
    const scrollTop = container.scrollTop;
    const directionDown = scrollTop > lastScrollTop;
    lastScrollTop = scrollTop;

    // Calculate current "first visible row" based on scrollTop
    const newStartIndex = Math.floor(scrollTop / ROW_HEIGHT);

    // If scrolling down and newStartIndex > startIndex, add next rows at bottom, remove from top
    if (directionDown && newStartIndex > startIndex) {
      const rowsToAdd = newStartIndex - startIndex;
      for (let i = 0; i < rowsToAdd; i++) {
        // Remove top row
        if (container.firstChild) container.removeChild(container.firstChild);

        // Add new row at bottom
        const nextIndex = startIndex + VISIBLE_ROWS + BUFFER + i;
        if (nextIndex < TOTAL_ROWS) {
          const row = document.createElement('div');
          row.className = 'row';
          row.textContent = `Row ${nextIndex + 1}`;
          container.appendChild(row);
        }
      }
      startIndex = newStartIndex;
    }

    // If scrolling up and newStartIndex < startIndex, add previous rows at top, remove from bottom
    else if (!directionDown && newStartIndex < startIndex) {
      const rowsToAdd = startIndex - newStartIndex;
      for (let i = 1; i <= rowsToAdd; i++) {
        // Remove bottom row
        if (container.lastChild) container.removeChild(container.lastChild);

        // Add new row at top
        const prevIndex = startIndex - i;
        if (prevIndex >= 0) {
          const row = document.createElement('div');
          row.className = 'row';
          row.textContent = `Row ${prevIndex + 1}`;
          container.insertBefore(row, container.firstChild);
        }
      }
      startIndex = newStartIndex;
    }
  });
</script>

</body>
</html>
